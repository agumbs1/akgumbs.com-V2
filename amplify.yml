version: 1
applications:
  - backend:
      phases:
        preBuild:
          - name: Install Python 3.12.7
            uses: actions/setup-python@v5
            with:
              python-version: 3.12.7
              cache: 'pip'

          - name: Install dependencies
            run: pip install -r requirements.txt

          - name: Download game log table
            uses: actions/download-artifact@v4
            with:
              name: log.csv
              path: artifacts/log.csv

          - name: Run evaluation script
            run: python3 scripts/evaluate.py

          - name: Make predictions for today's games
            run: python3 scripts/update.py

          - name: Download today's game data
            uses: actions/download-artifact@v4
            with:
              name: today.json
              path: src/today.json

        build:
          commands:
            # Add any build commands for your backend if needed
            - echo "Building backend..."

      artifacts:
        baseDirectory: /artifacts  # Ensure this points to the correct output path
        files:
          - '**/*'  # Upload all files in the artifacts directory

      cache:
        paths:
          - '.venv/**/*'
          - 'requirements.txt'

      # Upload the entire artifacts directory
      - name: Upload updated artifacts
        uses: actions/upload-artifact@v4
        with:
          name: artifacts
          path: artifacts/**  # This uploads everything in the artifacts directory

  - frontend:
      phases:
        preBuild:
          commands:
            - nvm install 18
            - npm install
        build:
          commands:
            - npm run build

      artifacts:
        baseDirectory: build  # Update this if your build output goes elsewhere
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*